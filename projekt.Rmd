---
title: "Analiza energetike v Evropi"
author: "Jakov Kavčič"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE,warning = FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Energija je ena od najpomembnejših surovin za vsako državo ali družbo. V zadnjih letih lahko opazimo več}jo volitilnost na energetskih trgih zaradi številnih ekonomskih, tehnoloških in geopolitičnih razlogov. Zaradi tega je zelo pomembno, da analiziramo pretekle spremembe v potroŠnji in porabi energije, saj le tako lahko predvidimo kakŠna bo naša potreba po energiji v prihodnosti. Vendar pred tem bom povzel dinamiko energetske porabe v Evropi in v določenih državah, v katerih je produkcija ali uvoz energije višja od povprečja. Večje skoke ali upade v porabi bom poskusil povezati z svetovnimi dogodki, saj le to nam bo dalo najboljše orodje za napoved dinamike v prihodnje. Osredotočil se bom na obdobje med 2000 in 2015. 

***

# Obdelava, uvoz in čiščenje podatkov

Podatke, ki sem jih uporabil pri ustvarjanju svojega projekta sem pridobil s spletne strani EUROSTAT. Poleg tega sem določene podatke posikal na Wikipediji. Oba vira mi bosta omogočila, da črpam neobdelane podatke ali v csv obliki ali v HTML obliki. 

Podatke bom pridobil na spletnih stranieh:

- [Letna bilanca enrgije](http://appsso.eurostat.ec.europa.eu/nui/show.do?query=BOOKMARK_DS-465368_QID_-1E68FBF1_UID_-3F171EB0&layout=TIME,C,X,0;GEO,L,Y,0;UNIT,L,Z,0;PRODUCT,L,Z,1;INDIC_NRG,L,Z,2;INDICATORS,C,Z,3;&zSelection=DS-465368PRODUCT,0000;DS-465368UNIT,KTOE;DS-465368INDIC_NRG,B_100900;DS-465368INDICATORS,OBS_FLAG;&rankName1=UNIT_1_2_-1_2&rankName2=INDICATORS_1_2_-1_2&rankName3=PRODUCT_1_2_-1_2&rankName4=INDIC-NRG_1_2_-1_2&rankName5=TIME_1_0_0_0&rankName6=GEO_1_2_0_1&sortC=ASC_-1_FIRST&rStp=&cStp=&rDCh=&cDCh=&rDM=true&cDM=true&footnes=false&empty=false&wai=false&time_mode=ROLLING&time_most_recent=false&lang=EN&cfo=%23%23%23%2C%23%23%23.%23%23%23)

- [Populacija evropskih držav](https://en.wikipedia.org/wiki/Demographics_of_Europe)

- [Kode držav po standardu ISO 3166-2](https://en.wikipedia.org/wiki/ISO_3166-2)

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz1.R", encoding = "UTF-8")
```

Uvozil sem podatke s EUROSTAT-a v obliki CSV ter v obliki HTML z Wikipedije. Poglejmo si začetke uvoženih razpredelnic.

## Oblika tabel

Tabela **all_products** vsebuje naslednje stolpce:

- **TIME** - leto *(Npr. 2000)*,

- **GEO** - država *(Npr. Slovenia)*,

- **PRODUCT** - vrsta energetske surovine *(Npr. Gas)*,

- **INDIC_NRG** - določa uvoz, izvoz ali poraba *(Npr. Exports)* in

- **Value** - količina energije izražene v terajoulih.

```{r razpredelnice1, echo=FALSE, message=FALSE}
kable(head(all_products), caption = "Letna bilanca enrgije")
```

Tabela **ak** vsebuje dva stolpca:

- **GEO** - država in

- **Koda** - kode držav po standardu ISO 3166-2.

```{r razpredelnica2, echo=FALSE,message=FALSE}
kable(head(ak),caption = "Kode držav po standardu ISO 3166-2")
```

Tabela **po** vsebuje dva stolpca:

- **GEO** - država in

- **Populacija** - populacija posamezne države.

```{r razpredelnica3, echo=FALSE,message=FALSE}
kable(head(po),caption = "Populacija evropskih držav")
```

***

# Vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, fig.width=10}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje potrošnjo energijskih virov na število prebivalcev v letu 2015. S tem sem hotel primerjati države glede na prebivalstvo. Lahko opazimo, da bolj industriske države imajo večji koeficjent. Najvišji koeficjent pa imajo seveda severne države zaradi njihovih vremenskih razmer. Daleč najvišji koeficjent ima Islandija, ki sem jo vendar izločil pri izdelavi te slike. 

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Potrošnja energijskih virov na število prebivalcev.', fig.width=10}
ggplot() + geom_polygon(data = zemljevid %>% left_join(poraba_po, by = c("NUTS_ID" = "Koda")),
                                aes(x = long, y = lat, group = group, fill = na.prebivalca)) +
        coord_map(xlim = c(-13, 48), ylim = c(32, 72)) +
        ggtitle("Potrošnja energijskih virov na število prebivalcev") + xlab("") + ylab("") +
        guides(fill = guide_colorbar(title = "TJ na prebivalca"))
```

Spodnja grafa prikazujeta gibanje energetske potrošnje držav skozi leta. Zaradi boljše preglednosti sem graf razdelil na dva dela, saj tako so spremembe dosti bolj opazne.

```{r graf1, echo=FALSE, fig.align='center', fig.width=10}
print(graf1)
```

```{r graf2, echo=FALSE, fig.align='center',fig.width=10}
print(graf2)
```

## Procentualna dinamika

Sestavil sem tudi novo tabelo **iz_leta_v_leto**, ki vsebuje podatke o letnih spremembah v energetski porabi v Evropski Uniji. Tabela ima naslednje stolpce:

- **TIME** - leto,

- **INDIC_NRG** - določa uvoz, izvoz ali poraba,

- **GEO** - država in

- **Rast** - sprememba potrošnje v primerjavi s preteklim letom v %.

```{r rast_porabe, echo=FALSE,fig.align='center',fig.width=10}
kable(head(iz_leta_v_leto), caption = "Rast porabe ")
```

Spodnji graf prikazuje gibanje potrošnje v Evropski Uniji iz leta v leto. Lahko opazimo trend upadanja potrošnje po letu 2003. Vendar v vsakem slučaju so spremembe relativno majhne. Med leti 2000 in 2015 je energetska poraba v evropi porasla za 6.3%.

```{r rast_EU28, echo=FALSE,fig.align='center',fig.width=10, fig.cap="Dinamika rasti v %"}
print(rast_EU28)
```

Na isti način sem sestavil graf še za Slovenijo in Nemčijo.

```{r rast_Slo_Nem, echo=FALSE,fig.align='center',fig.width=10}
print(rast_Slo, fig.cap="Dinamika Slovenske porabe v %")
print(rast_Ger, caption="Dinamika Nemške porabe v %")
```

Podobno kot prej sem sestavil tabelo, ki prikazuje rast uvoza, ter izvoza za Evropsko Unijo, Slovenijo ter Nemčijo. S pomočjo te tabele pa sem oblikoval naslednje grafe, ki prikazujejo dinamiko uvoza v državah in uniji.

```{r rast_izvoza, echo=FALSE,fig.align='center',fig.width=10}
print(rast_i_EU28, caption="Dinamika izvoza Evropske Unije v %")
print(rast_i_Slo, caption="Dinamika Slovenskega izvoza v %")
print(rast_i_Ger, caption="Dinamika Nemškega izvoza v %")
```

Zanimala me je tudi agregatna sprememba uvoza, izvoza in porabe, med leti 2001 in 2015. Za ta namen sem ustvaril novo tabelo **rast_01_15**, ki vsebuje procentualne spremembe. Z namenom boljše vizualizacije sem ustvaril naslednje tri grafe, ki prikazujejo procentualno spremembo.

```{r rast_01_15, echo=FALSE,fig.align='center',fig.width=10,warning = FALSE}
print(izvoz_01_15, caption="Spremembe izvoza v %")
print(uvoz_01_15, caption="Spremembe uvoza v %")
print(poraba_01_15, caption="Spremembe porabe v %")
```

## Odvisnost uvoza, izvoza in porabe 

Hotel sem tudi preveriti odvisnost med uvozom, izvozom in porabo. Na nivoju Evropske Unije sem ugotovil, da so vsi trije elementi med seboj pozitivno povezani. Torej če poraste poraba bodo porasla poraba in izvoz. Ista odvisnost je prisotna tudi v Nemčiji. V primeru Norveške pa ni tako. Odnos med uvozom in porabo je pozitiven, vendar odnosa med uvozom in izvozom, ter med porabo in izvozom sta negativna. To pa je dosti bolj logičen rezultat. To pomeni, da ko poraba poraste, poraste tudi uvoz in izvoz vpade. 

## Delež posameznih produktov

Zanimalo me je katere produkte v Evropski Uniji najbolj uporabljamo. Zato sem izračunal delež vskega produkta v celotni porabi. Predvidljivo se je izkazalo da največ uporabljamo petrolejske produkte, torej benzin, dizel itd.. Naslednji najbolj uporabljen produkt pa je plin, kateremu pa sledijo trdna goriva. Na spodnjem grafu lahko razberemo delež vsakega od produktov.

```{r delez_p_EU28, echo=FALSE,fig.align='center',fig.width=10}
print(sestava_p_EU28)
```

Evropska Unija tudi največ izvaža petrolejska goriva in to, kar 69.3%. Sestavo izvoza Evropske Unije lahko vidimo na spodnjem grafu.

```{r delez_i_EU28, echo=FALSE,fig.align='center',fig.width=10}
print(sestava_i_EU28)
```

Posledično nas ne more presenetiti, da tudi uvoz petrolejskih produktov predstavlja največji delež celotnega uvoza in sicer kar 63.2%.

```{r delez_u_EU28, echo=FALSE,fig.align='center',fig.width=10}
print(sestava_u_EU28)
```

***

```{r shiny, echo = FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
