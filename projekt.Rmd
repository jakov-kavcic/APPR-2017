---
title: "Analiza Evropske proizvodnje in porabe energije"
author: "Jakov Kavčič"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Energija je ena od najpomembnejših surovin za vsako državo ali družbo. V zadnjih letih lahko opazimo več}jo volitilnost na energetskih trgih zaradi številnih ekonomskih, tehnoloških in geopolitičnih razlogov. Zaradi tega je zelo pomembno, da analiziramo pretekle spremembe v potroŠnji in porabi energije, saj le tako lahko predvidimo kakŠna bo naša potreba po energiji v prihodnosti. Vendar pred tem bom povzel dinamiko energetske porabe v Evropi in v določenih državah, v katerih je produkcija ali uvoz energije višja od povprečja. Večje skoke ali upade v porabi bom poskusil povezati z svetovnimi dogodki, saj le to nam bo dalo najboljše orodje za napoved dinamike v prihodnje. Osredotočil se bom na obdobje med 2000 in 2015. 

***

# Obdelava, uvoz in čiščenje podatkov

Podatke, ki sem jih uporabil pri ustvarjanju svojega projekta sem pridobil s spletne strani EUROSTAT. Poleg tega sem določene podatke posikal na Wikipediji. Oba vira mi bosta omogočila, da črpam neobdelane podatke ali v csv obliki ali v HTML obliki. 

Podatke bom pridobil na spletnih stranieh:

- [Letna bilanca enrgije](http://appsso.eurostat.ec.europa.eu/nui/show.do?query=BOOKMARK_DS-465368_QID_-1E68FBF1_UID_-3F171EB0&layout=TIME,C,X,0;GEO,L,Y,0;UNIT,L,Z,0;PRODUCT,L,Z,1;INDIC_NRG,L,Z,2;INDICATORS,C,Z,3;&zSelection=DS-465368PRODUCT,0000;DS-465368UNIT,KTOE;DS-465368INDIC_NRG,B_100900;DS-465368INDICATORS,OBS_FLAG;&rankName1=UNIT_1_2_-1_2&rankName2=INDICATORS_1_2_-1_2&rankName3=PRODUCT_1_2_-1_2&rankName4=INDIC-NRG_1_2_-1_2&rankName5=TIME_1_0_0_0&rankName6=GEO_1_2_0_1&sortC=ASC_-1_FIRST&rStp=&cStp=&rDCh=&cDCh=&rDM=true&cDM=true&footnes=false&empty=false&wai=false&time_mode=ROLLING&time_most_recent=false&lang=EN&cfo=%23%23%23%2C%23%23%23.%23%23%23)

- [Populacija evropskih držav](https://en.wikipedia.org/wiki/Demographics_of_Europe)

- [Kode držav po standardu ISO 3166-2](https://en.wikipedia.org/wiki/ISO_3166-2)

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz1.R", encoding = "UTF-8")
```

Uvozil sem podatke s EUROSTAT-a v obliki CSV ter v obliki HTML z Wikipedije. Poglejmo si začetke uvoženih razpredelnic.

# Oblika tabel

Tabela **all_products** vsebuje naslednje stolpce:

- **TIME** - leto *(Npr. 2000)*,

- **GEO** - država *(Npr. Slovenia)*,

- **PRODUCT** - vrsta energetske surovine *(Npr. Gas)*,

- **INDIC_NRG** - določa količino uvoza, izvoza in porabe *(Npr. Exports)* in

- **Value** - količina energije izražene v terajoulih.

```{r razpredelnice1, echo=FALSE, message=FALSE}
kable(head(all_products), caption = "Letna bilanca enrgije")
```

Tabela **ak** vsebuje dva stolpca:

- **GEO** - država in

- **Koda** - kode držav po standardu ISO 3166-2.

```{r razpredelnica2, echo=FALSE,message=FALSE}
kable(head(ak),caption = "Kode držav po standardu ISO 3166-2")
```

Tabela **po** vsebuje dva stolpca:

- **GEO** - država in

- **Populacija** - populacija posamezne države.

```{r razpredelnica3, echo=FALSE,message=FALSE}
kable(head(po),caption = "Populacija evropskih držav")
```

***

# Vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje potrošnjo energijskih virov na število prebivalcev v letu 2015. S tem sem hotel primerjati države glede na prebivalstvo. Lahko opazimo, da bolj industriske države imajo večji koeficjent. Najvišji koeficjent pa imajo seveda severne države zaradi njihovih vremenskih razmer. Daleč najvišji koeficjent ima Islandija, ki sem jo vendar izločil pri izdelavi te slike. 

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Potrošnja energijskih virov na število prebivalcev.', fig.width=10}
ggplot() + geom_polygon(data = zemljevid %>% left_join(poraba_po, by = c("NUTS_ID" = "Koda")),
                                aes(x = long, y = lat, group = group, fill = na.prebivalca)) +
        coord_map(xlim = c(-13, 48), ylim = c(32, 72)) +
        ggtitle("Potrošnja energijskih virov na število prebivalcev") + xlab("") + ylab("") +
        guides(fill = guide_colorbar(title = "TJ na prebivalca"))
```

Spodnja grafa prikazujeta gibanje energetske potrošnje držav skozi leta. Zaradi boljše preglednosti sem graf razdelil na dva dela, saj tako so spremembe dosti bolj opazne.

```{r graf1, echo=FALSE, fig.align='center', fig.width=10}
print(graf1)
```

```{r graf2, echo=FALSE, fig.align='center',fig.width=10}
print(graf2)
```
***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
#source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:graf} prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
# ggplot(inner_join(obcine, data.frame(obcina = names(skupine),
#                                      skupina = factor(skupine)), by = "obcina")
# , aes(x = povrsina, y = naselja, color = skupina, size = prebivalci/1000)) + geom_point() +
#   ggtitle("Število naselij glede na površino občine") +
#   xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
#   guides(color = guide_legend(title = "Skupina"),
#          size = guide_legend(title = "Prebivalci (* 1000)"))
```

***

```{r shiny, echo = FALSE}
#shinyAppDir("shiny", options=list(width="100%", height=600))
```
